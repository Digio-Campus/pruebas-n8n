{
    "createdAt":  "2025-07-29T10:15:40.551Z",
    "updatedAt":  "2025-07-29T10:17:05.000Z",
    "id":  "7eIaV8HdsJr2f8JD",
    "name":  "ExtraerFacturas2",
    "active":  false,
    "isArchived":  false,
    "nodes":  [
                  {
                      "parameters":  {
                                         "operation":  "get",
                                         "messageId":  "={{ $json.id }}",
                                         "simple":  false,
                                         "options":  {
                                                         "dataPropertyAttachmentsPrefixName":  "attachment_",
                                                         "downloadAttachments":  true
                                                     }
                                     },
                      "type":  "n8n-nodes-base.gmail",
                      "typeVersion":  2.1,
                      "position":  [
                                       -1888,
                                       128
                                   ],
                      "id":  "1cf0559f-1f90-49c4-95c7-5fb2e7653403",
                      "name":  "Get a message",
                      "webhookId":  "8f48484d-7f62-485c-8e45-365b758e2002"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "// https://community.n8n.io/t/iterating-over-email-attachments/13588/3\nlet results = [];\n\nfor (const item of $input.all()) {\n  console.log(item);\n  for (const key of Object.keys(item.binary)) {\n    results.push({\n        json: {fileName : item.binary[key].fileName },\n        binary: {\n            data: item.binary[key],\n        }\n    });\n  }\n}\n\nreturn results;"
                                     },
                      "id":  "d29d03f0-623d-4aa8-a784-e5481bb98aae",
                      "name":  "Iterate over email attachments",
                      "type":  "n8n-nodes-base.code",
                      "position":  [
                                       -1664,
                                       128
                                   ],
                      "typeVersion":  1
                  },
                  {
                      "parameters":  {

                                     },
                      "id":  "b49d83e9-a72a-4529-8e8d-b7bd49819733",
                      "name":  "Read PDF email attachments",
                      "type":  "n8n-nodes-base.readPDF",
                      "position":  [
                                       -992,
                                       -128
                                   ],
                      "notesInFlow":  false,
                      "typeVersion":  1,
                      "onError":  "continueErrorOutput"
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "string":  [
                                                                           {
                                                                               "value1":  "={{ $binary.data.fileExtension }}",
                                                                               "value2":  "pdf"
                                                                           }
                                                                       ]
                                                        }
                                     },
                      "id":  "020acc6e-0eb0-4185-9d1d-f58ab642f8fd",
                      "name":  "Is attachment a PDF?",
                      "type":  "n8n-nodes-base.if",
                      "position":  [
                                       -1216,
                                       128
                                   ],
                      "typeVersion":  1
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "options":  {
                                                                            "caseSensitive":  false,
                                                                            "leftValue":  "",
                                                                            "typeValidation":  "strict",
                                                                            "version":  2
                                                                        },
                                                            "conditions":  [
                                                                               {
                                                                                   "id":  "44c7b8fb-54b7-4208-a0ea-af174d2afd5c",
                                                                                   "leftValue":  "={{$json.fileName}}",
                                                                                   "rightValue":  "factura",
                                                                                   "operator":  {
                                                                                                    "type":  "string",
                                                                                                    "operation":  "contains"
                                                                                                }
                                                                               }
                                                                           ],
                                                            "combinator":  "and"
                                                        },
                                         "options":  {
                                                         "ignoreCase":  true
                                                     }
                                     },
                      "type":  "n8n-nodes-base.filter",
                      "typeVersion":  2.2,
                      "position":  [
                                       -1440,
                                       128
                                   ],
                      "id":  "db978d93-7acc-4c88-879a-ba92b985e957",
                      "name":  "Filtrar por nombre"
                  },
                  {
                      "parameters":  {
                                         "options":  {

                                                     }
                                     },
                      "type":  "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
                      "typeVersion":  1,
                      "position":  [
                                       -672,
                                       96
                                   ],
                      "id":  "7cfd55ab-f3d1-4006-923a-ec0de3de929f",
                      "name":  "Google Gemini Chat Model"
                  },
                  {
                      "parameters":  {
                                         "pollTimes":  {
                                                           "item":  [
                                                                        {
                                                                            "mode":  "everyHour"
                                                                        }
                                                                    ]
                                                       },
                                         "filters":  {
                                                         "q":  "has:attachment"
                                                     }
                                     },
                      "type":  "n8n-nodes-base.gmailTrigger",
                      "typeVersion":  1.2,
                      "position":  [
                                       -2112,
                                       128
                                   ],
                      "id":  "89ad8a60-024d-40f3-8c7d-5957be572653",
                      "name":  "Gmail Trigger"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "// Loop over input items and add a new field called \u0027myNewField\u0027 to the JSON of each one\nfor (const item of $input.all()) {\n  const jsonMatch =  item.json.output.match(/```json\\n([\\s\\S]*?)\\n```/);\n  let jsonString = jsonMatch ? jsonMatch[1] : item.json.output;\n  // Limpia cualquier carÃ¡cter extra\n  jsonString = jsonString.trim();\n\n  item.json = JSON.parse(jsonString);\n}\n\nreturn $input.all();"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       -368,
                                       -128
                                   ],
                      "id":  "fde83659-24ee-4d72-8aa1-3fde3bcd870a",
                      "name":  "Sacar el JSON de la respuesta"
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "options":  {
                                                                            "caseSensitive":  true,
                                                                            "leftValue":  "",
                                                                            "typeValidation":  "strict",
                                                                            "version":  2
                                                                        },
                                                            "conditions":  [
                                                                               {
                                                                                   "id":  "2d6d6187-27a0-4430-999f-5e863bdb48a5",
                                                                                   "leftValue":  "={{ $json.observaciones_IA.length }}",
                                                                                   "rightValue":  0,
                                                                                   "operator":  {
                                                                                                    "type":  "number",
                                                                                                    "operation":  "notEquals"
                                                                                                }
                                                                               }
                                                                           ],
                                                            "combinator":  "and"
                                                        },
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.if",
                      "typeVersion":  2.2,
                      "position":  [
                                       -144,
                                       -128
                                   ],
                      "id":  "0bae8d58-3df4-45e6-ac25-967fe79600c8",
                      "name":  "Has any errors?"
                  },
                  {
                      "parameters":  {
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.extractFromFile",
                      "typeVersion":  1,
                      "position":  [
                                       752,
                                       160
                                   ],
                      "id":  "1a16482a-4e71-4d05-9d7c-a26af32c921d",
                      "name":  "Extract from File"
                  },
                  {
                      "parameters":  {
                                         "options":  {

                                                     }
                                     },
                      "type":  "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
                      "typeVersion":  1,
                      "position":  [
                                       1456,
                                       192
                                   ],
                      "id":  "7d95a724-a767-47a7-8db0-7a514b317332",
                      "name":  "Google Gemini Chat Model1"
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "string":  [
                                                                           {
                                                                               "value1":  "={{ $binary.data.fileExtension }}",
                                                                               "value2":  "csv"
                                                                           }
                                                                       ]
                                                        }
                                     },
                      "id":  "554d075a-3e40-48bf-9f61-215ecbb22c80",
                      "name":  "Is attachment a CSV?",
                      "type":  "n8n-nodes-base.if",
                      "position":  [
                                       528,
                                       256
                                   ],
                      "typeVersion":  1
                  },
                  {
                      "parameters":  {
                                         "assignments":  {
                                                             "assignments":  [

                                                                             ]
                                                         },
                                         "includeOtherFields":  true,
                                         "include":  "except",
                                         "excludeFields":  "observaciones_IA, data",
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.set",
                      "typeVersion":  3.4,
                      "position":  [
                                       976,
                                       -128
                                   ],
                      "id":  "6dc5fe7c-8f02-4dd9-b852-4b1264d7a9b9",
                      "name":  "Eliminar observaciones IA"
                  },
                  {
                      "parameters":  {

                                     },
                      "id":  "741cd2d4-45cd-47e1-a505-c4f435d5f404",
                      "name":  "Neither PDF or CSV",
                      "type":  "n8n-nodes-base.noOp",
                      "position":  [
                                       752,
                                       352
                                   ],
                      "typeVersion":  1
                  },
                  {
                      "parameters":  {
                                         "promptType":  "define",
                                         "text":  "=A continuaciÃ³n te paso una factura en texto plano sacada de un pdf, sin formato. DevuÃ©lveme un JSON estructurado con los campos detectados, incluyendo conceptos, totales, datos del cliente y emisor si estÃ¡n presentes:\n\nEste es el nombre del pdf:\n```\n{{ $binary.data.fileName }}\n```\n\nEste es el contenido del pdf:\n```\n{{ $json.text }}\n```",
                                         "options":  {
                                                         "systemMessage":  "=ActÃºa como un asistente experto en extracciÃ³n de datos estructurados a partir de facturas en texto plano. Tu tarea es convertir textos sin formato en un objeto JSON con la estructura exacta que se indica a continuaciÃ³n, manteniendo los nombres de los campos tal como estÃ¡n escritos:\n\n```json\n{\n  \"numero_factura\": \"\",\n  \"fecha\" : \"\",\n  \"empresa\": {\n    \"nombre\": \"\",\n    \"direccion\": \"\",\n    \"mail\": \"\",\n    \"telefono\": \"\",\n    \"cif\": \"\",\n    \"fax\": \"\",\n    \"web\": \"\"\n  },\n  \"cliente\": {\n    \"nombre\": \"\",\n    \"direccion\": \"\",\n    \"mail\": \"\",\n    \"telefono\": \"\"\n  },\n  \"conceptos\": [\n    {\n      \"descripcion\": \"\",\n      \"cantidad\": \"\",\n      \"precio\": \"\",\n      \"total_linea\": \"\"\n    }\n  ],\n  \"totales\": {\n    \"subtotal\": \"\",\n    \"impuestos\": [\n      {\n        \"porcentaje\": \"\",\n        \"cantidad\": \"\"\n      }\n    ],\n    \"total\": \"\"\n  },\n  \"forma_pago\": \"\",\n  \"notas_factura\": \"\",\n  \"observaciones_IA\": []\n}\n```\n\nReglas importantes:\nSi no hay informaciÃ³n disponible para algÃºn campo, debes dejarlo como una cadena vacÃ­a (\"\"), nunca omitirlo.\n\nExtrae todos los conceptos si estÃ¡n disponibles, y colÃ³calos en la lista conceptos.\n\nSi detectas impuestos (como IVA o IRPF), inclÃºyelos en la lista totales.impuestos con su porcentaje y cantidad.\n\nTodos los formatos nÃºmericos deben ir sin su unidad, por ejemplo 100â‚¬ a 100 o 7% a 7.\n\nLa fecha, si esta, conviertela a formato dateTime. \n\nEn observaciones_IA, escribe cualquier duda, incoherencia, posible error o ambigÃ¼edad detectada (por ejemplo: totales que no cuadran, fechas dudosas, campos duplicados, etc.).\n\nNo inventes valores. Extrae sÃ³lo lo que estÃ© presente de forma explÃ­cita.\n\nEl JSON debe estar bien indentado y ser vÃ¡lido."
                                                     }
                                     },
                      "type":  "@n8n/n8n-nodes-langchain.agent",
                      "typeVersion":  2.1,
                      "position":  [
                                       -768,
                                       -128
                                   ],
                      "id":  "b811123a-72ca-487f-a188-7391e7a3232b",
                      "name":  "PDF to JSON Agent"
                  },
                  {
                      "parameters":  {
                                         "promptType":  "define",
                                         "text":  "=A continuaciÃ³n te paso un JSON que representa una factura, junto con la estructura relacional a la que debe insertarse. DevuÃ©lveme un script SQL, usando CTEs (`WITH ...`) para hacer todas las inserciones en una sola operaciÃ³n.\n\n### Estructura de tablas:\n\n- `empresa(id, nombre, direccion, mail, telefono, cif, fax, web)`\n- `cliente(id, nombre, direccion, mail, telefono)`\n- `factura(id, numero_factura, fecha, empresa_id, cliente_id, forma_pago, notas_factura)`\n- `concepto(id, factura_id, descripcion, cantidad, precio, total_linea)`\n- `impuesto(id, factura_id, porcentaje, cantidad)`\n- `resumen(factura_id, subtotal, total)`\n\n### JSON de entrada:\n{{$json.toJsonString()}}\n",
                                         "options":  {
                                                         "systemMessage":  "=Eres un asistente experto en bases de datos PostgreSQL y Supabase. Dado un JSON que representa una factura, tu tarea es generar un script SQL completo que inserte todos los datos en una base de datos PostgreSQL previamente creada, siguiendo una estructura relacional normalizada y llamar a la herramienta \"postgres\" para ejecutarla.\n\nEl script debe:\n- Usar `WITH` para insertar empresa, cliente, factura, conceptos, impuestos y resumen en una Ãºnica transacciÃ³n SQL.\n- Ser compatible con Supabase (PostgreSQL puro).\n- Asegurar claves forÃ¡neas y relaciones entre tablas correctamente.\n- Usar `RETURNING id` para recuperar claves y pasarlas entre pasos.\n- Devolver al final `SELECT \u0027Todo insertado correctamente\u0027;` como mensaje.\n\nNo inventes datos, trabaja solamente con los datos que recibes del usuario, si no tienes datos suficientes para hacer la consulta, devuelve un error no un script con datos generados.\n\nNo generes las definiciones de tablas. Asume que ya existen y estÃ¡n normalizadas, y que se crearon usando el siguiente script:\n\n```sql \n-- Tabla empresa\nCREATE TABLE empresa (\n  id SERIAL PRIMARY KEY,\n  nombre TEXT NOT NULL,\n  direccion TEXT,\n  mail TEXT,\n  telefono TEXT,\n  cif TEXT UNIQUE,\n  fax TEXT,\n  web TEXT\n);\n\n-- Tabla cliente\nCREATE TABLE cliente (\n  id SERIAL PRIMARY KEY,\n  nombre TEXT NOT NULL,\n  direccion TEXT,\n  mail TEXT UNIQUE,\n  telefono TEXT\n);\n\n-- Tabla factura\nCREATE TABLE factura (\n  id SERIAL PRIMARY KEY,\n  numero_factura TEXT UNIQUE NOT NULL,\n  fecha DATE NOT NULL,\n  empresa_id INTEGER REFERENCES empresa(id) ON DELETE SET NULL,\n  cliente_id INTEGER REFERENCES cliente(id) ON DELETE SET NULL,\n  forma_pago TEXT,\n  notas_factura TEXT\n);\n\n-- Tabla concepto (lÃ­neas de factura)\nCREATE TABLE concepto (\n  id SERIAL PRIMARY KEY,\n  factura_id INTEGER REFERENCES factura(id) ON DELETE CASCADE,\n  descripcion TEXT NOT NULL,\n  cantidad NUMERIC(10, 2) NOT NULL,\n  precio NUMERIC(10, 2) NOT NULL,\n  total_linea NUMERIC(10, 2) NOT NULL\n);\n\n-- Tabla impuesto (totales por tipo de impuesto en la factura)\nCREATE TABLE impuesto (\n  id SERIAL PRIMARY KEY,\n  factura_id INTEGER REFERENCES factura(id) ON DELETE CASCADE,\n  porcentaje NUMERIC(5, 2) NOT NULL,\n  cantidad NUMERIC(10, 2) NOT NULL\n);\n\n-- Tabla resumen (totales de la factura)\nCREATE TABLE resumen (\n  factura_id INTEGER PRIMARY KEY REFERENCES factura(id) ON DELETE CASCADE,\n  subtotal NUMERIC(10, 2) NOT NULL,\n  total NUMERIC(10, 2) NOT NULL\n);\n```\n\nUn ejemplo de JSON y su script sql asociado seria el siguiente\n\n```json\n{\n  \"numero_factura\": \"F-001\",\n  \"fecha\": \"2025-07-18\",\n  \"empresa\": {\n    \"nombre\": \"TechCorp S.A.\",\n    \"direccion\": \"Calle Falsa 123, Madrid\",\n    \"mail\": \"info@techcorp.com\",\n    \"telefono\": \"911234567\",\n    \"cif\": \"B12345678\",\n    \"fax\": \"911234568\",\n    \"web\": \"https://techcorp.com\"\n  },\n  \"cliente\": {\n    \"nombre\": \"Juan PÃ©rez\",\n    \"direccion\": \"Av. Siempre Viva 742, Sevilla\",\n    \"mail\": \"juan.perez@example.com\",\n    \"telefono\": \"655443322\"\n  },\n  \"conceptos\": [\n    {\n      \"descripcion\": \"DiseÃ±o web\",\n      \"cantidad\": 1,\n      \"precio\": 1000.00,\n      \"total_linea\": 1000.00\n    },\n    {\n      \"descripcion\": \"Mantenimiento mensual\",\n      \"cantidad\": 2,\n      \"precio\": 150.00,\n      \"total_linea\": 300.00\n    }\n  ],\n  \"totales\": {\n    \"subtotal\": 1300.00,\n    \"impuestos\": [\n      {\n        \"porcentaje\": 21.00,\n        \"cantidad\": 273.00\n      }\n    ],\n    \"total\": 1573.00\n  },\n  \"forma_pago\": \"Transferencia bancaria\",\n  \"notas_factura\": \"Gracias por su confianza.\"\n}\n```\n\n```sql\n-- Empresa: insertar solo si no existe (por CIF)\nWITH nueva_empresa AS (\n  INSERT INTO empresa (nombre, direccion, mail, telefono, cif, fax, web)\n  VALUES (\n    \u0027TechCorp S.A.\u0027, \u0027Calle Falsa 123, Madrid\u0027, \u0027info@techcorp.com\u0027,\n    \u0027911234567\u0027, \u0027B12345678\u0027, \u0027911234568\u0027, \u0027https://techcorp.com\u0027\n  )\n  ON CONFLICT (cif) DO UPDATE\n    SET nombre = EXCLUDED.nombre\n  RETURNING id\n),\nempresa_existente AS (\n  SELECT id FROM empresa WHERE cif = \u0027B12345678\u0027\n),\nempresa_final AS (\n  SELECT id FROM nueva_empresa\n  UNION\n  SELECT id FROM empresa_existente\n),\n\n-- Cliente: insertar solo si no existe (por mail)\nnuevo_cliente AS (\n  INSERT INTO cliente (nombre, direccion, mail, telefono)\n  VALUES (\n    \u0027Juan PÃ©rez\u0027, \u0027Av. Siempre Viva 742, Sevilla\u0027,\n    \u0027juan.perez@example.com\u0027, \u0027655443322\u0027\n  )\n  ON CONFLICT (mail) DO UPDATE\n    SET nombre = EXCLUDED.nombre\n  RETURNING id\n),\ncliente_existente AS (\n  SELECT id FROM cliente WHERE mail = \u0027juan.perez@example.com\u0027\n),\ncliente_final AS (\n  SELECT id FROM nuevo_cliente\n  UNION\n  SELECT id FROM cliente_existente\n),\n\n-- Factura\nnueva_factura AS (\n  INSERT INTO factura (numero_factura, fecha, empresa_id, cliente_id, forma_pago, notas_factura)\n  SELECT\n    \u0027F-001\u0027, \u00272025-07-18\u0027,\n    empresa_final.id, cliente_final.id,\n    \u0027Transferencia bancaria\u0027, \u0027Gracias por su confianza.\u0027\n  FROM empresa_final, cliente_final\n  RETURNING id\n),\n\n-- Conceptos\ninsert_conceptos AS (\n  INSERT INTO concepto (factura_id, descripcion, cantidad, precio, total_linea)\n  SELECT id, \u0027DiseÃ±o web\u0027, 1, 1000.00, 1000.00 FROM nueva_factura\n  UNION ALL\n  SELECT id, \u0027Mantenimiento mensual\u0027, 2, 150.00, 300.00 FROM nueva_factura\n),\n\n-- Impuestos\ninsert_impuestos AS (\n  INSERT INTO impuesto (factura_id, porcentaje, cantidad)\n  SELECT id, 21.00, 273.00 FROM nueva_factura\n),\n\n-- Resumen\ninsert_resumen AS (\n  INSERT INTO resumen (factura_id, subtotal, total)\n  SELECT id, 1300.00, 1573.00 FROM nueva_factura\n)\n\nSELECT \u0027Todo insertado correctamente\u0027;\n\n```\n"
                                                     }
                                     },
                      "type":  "@n8n/n8n-nodes-langchain.agent",
                      "typeVersion":  2.1,
                      "position":  [
                                       1424,
                                       -32
                                   ],
                      "id":  "54d4aa8f-0110-4786-a208-4ed0dd7b816b",
                      "name":  "JSON to SQL Agent"
                  },
                  {
                      "parameters":  {
                                         "jsCode":  "const facturasMap = {};\n\nfor (const item of $input.all()) {\n  const data = item.json;\n  const numFactura = data.numero_factura;\n\n  if (!facturasMap[numFactura]) {\n    //Creas la estructura y datos generales\n    facturasMap[numFactura] = {\n      numero_factura: data.numero_factura,\n      fecha: data.fecha,\n      empresa: {\n        nombre: data.empresa_nombre || \"\",\n        direccion: data.empresa_direccion || \"\",\n        mail: data.empresa_mail || \"\",\n        telefono: data.empresa_telefono || \"\",\n        cif: data.empresa_cif || \"\",\n        fax: data.empresa_fax || \"\",\n        web: data.empresa_web || \"\"\n      },\n      cliente: {\n        nombre: data.cliente_nombre || \"\",\n        direccion: data.cliente_direccion || \"\",\n        mail: data.cliente_mail || \"\",\n        telefono: data.cliente_telefono || \"\"\n      },\n      conceptos: [],\n      totales: {\n        subtotal: data.subtotal || \"\",\n        impuestos: [], \n        total: data.total || \"\"\n      },\n      forma_pago: data.forma_pago || \"\",\n      notas_factura: data.notas_factura || \"\"\n    };\n  }\n\n  // Agregar lÃ­nea de concepto\n  facturasMap[numFactura].conceptos.push({\n    descripcion: data.concepto_descripcion || \"\",\n    cantidad: data.concepto_cantidad || \"\",\n    precio: data.concepto_precio || \"\",\n    total_linea: data.concepto_total_linea || \"\"\n  });\n\n  const impuestos = [];\n\n  for (const key in data) {\n    if (key.startsWith(\u0027impuesto_porcentaje\u0027)) {\n      const sufijo = key.replace(\u0027impuesto_porcentaje_\u0027, \u0027\u0027);\n      const porcentaje = data[key];\n      const cantidad = data[`impuesto_cantidad_${sufijo}`] || 0;\n      const nombre = sufijo.toUpperCase(); // o sacarlo de otro campo si lo tienes\n      impuestos.push({\n        nombre,\n        porcentaje,\n        cantidad\n      });\n    }\n}\n\nfacturasMap[numFactura].totales.impuestos = impuestos;\n\n}\n\n// Convertimos a array de facturas\nconst facturas = Object.values(facturasMap);\n\n// Devolver como salida de items de n8n\nreturn facturas.map(factura =\u003e ({ json: factura }));\n"
                                     },
                      "type":  "n8n-nodes-base.code",
                      "typeVersion":  2,
                      "position":  [
                                       976,
                                       160
                                   ],
                      "id":  "f823e9b5-009c-4b14-af4e-7578c4248192",
                      "name":  "Agrupar facturas"
                  },
                  {
                      "parameters":  {
                                         "operation":  "executeQuery",
                                         "query":  "{{$fromAI(\u0027query\u0027) }}",
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.postgresTool",
                      "typeVersion":  2.6,
                      "position":  [
                                       1584,
                                       192
                                   ],
                      "id":  "3a2be96d-19f8-438d-9912-0237bb2a365c",
                      "name":  "Execute a SQL query in Postgres"
                  },
                  {
                      "parameters":  {

                                     },
                      "type":  "n8n-nodes-base.merge",
                      "typeVersion":  3.2,
                      "position":  [
                                       1200,
                                       -32
                                   ],
                      "id":  "72224f9d-87f2-457a-b6af-f985de091249",
                      "name":  "Merge PDF and CSV"
                  },
                  {
                      "parameters":  {

                                     },
                      "type":  "n8n-nodes-base.merge",
                      "typeVersion":  3.2,
                      "position":  [
                                       752,
                                       -128
                                   ],
                      "id":  "cee3e482-725e-465b-97a6-8c2d96c48c14",
                      "name":  "Merge Errors"
                  },
                  {
                      "parameters":  {
                                         "conditions":  {
                                                            "options":  {
                                                                            "caseSensitive":  true,
                                                                            "leftValue":  "",
                                                                            "typeValidation":  "strict",
                                                                            "version":  2
                                                                        },
                                                            "conditions":  [
                                                                               {
                                                                                   "id":  "2d6d6187-27a0-4430-999f-5e863bdb48a5",
                                                                                   "leftValue":  "={{ $json.data.approved }}",
                                                                                   "rightValue":  "=Continue with errors",
                                                                                   "operator":  {
                                                                                                    "type":  "boolean",
                                                                                                    "operation":  "true",
                                                                                                    "singleValue":  true
                                                                                                }
                                                                               }
                                                                           ],
                                                            "combinator":  "and"
                                                        },
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.if",
                      "typeVersion":  2.2,
                      "position":  [
                                       528,
                                       -208
                                   ],
                      "id":  "610ae637-2573-42aa-873a-6aebdb96192a",
                      "name":  "Approved?"
                  },
                  {
                      "parameters":  {
                                         "mode":  "combine",
                                         "combinationMode":  "mergeByPosition",
                                         "options":  {

                                                     }
                                     },
                      "id":  "e12b796a-5736-4a99-b39a-7e1c61a1aacc",
                      "name":  "Merge",
                      "type":  "n8n-nodes-base.merge",
                      "position":  [
                                       304,
                                       -208
                                   ],
                      "typeVersion":  2
                  },
                  {
                      "parameters":  {
                                         "url":  "https://javilujann.app.n8n.cloud/webhook-test/47a5eda8-ca47-4b5c-893c-32596289d2c2",
                                         "sendBody":  true,
                                         "specifyBody":  "json",
                                         "jsonBody":  "={{ $json.toJsonString() }}",
                                         "options":  {

                                                     }
                                     },
                      "type":  "n8n-nodes-base.httpRequest",
                      "typeVersion":  4.2,
                      "position":  [
                                       80,
                                       -304
                                   ],
                      "id":  "0134e35a-1631-45fd-803b-73d0dc0fc1cf",
                      "name":  "HTTP Request"
                  }
              ],
    "connections":  {
                        "Get a message":  {
                                              "main":  [
                                                           [
                                                               {
                                                                   "node":  "Iterate over email attachments",
                                                                   "type":  "main",
                                                                   "index":  0
                                                               }
                                                           ]
                                                       ]
                                          },
                        "Iterate over email attachments":  {
                                                               "main":  [
                                                                            [
                                                                                {
                                                                                    "node":  "Filtrar por nombre",
                                                                                    "type":  "main",
                                                                                    "index":  0
                                                                                }
                                                                            ]
                                                                        ]
                                                           },
                        "Is attachment a PDF?":  {
                                                     "main":  [
                                                                  [
                                                                      {
                                                                          "node":  "Read PDF email attachments",
                                                                          "type":  "main",
                                                                          "index":  0
                                                                      }
                                                                  ],
                                                                  [
                                                                      {
                                                                          "node":  "Is attachment a CSV?",
                                                                          "type":  "main",
                                                                          "index":  0
                                                                      }
                                                                  ]
                                                              ]
                                                 },
                        "Filtrar por nombre":  {
                                                   "main":  [
                                                                [
                                                                    {
                                                                        "node":  "Is attachment a PDF?",
                                                                        "type":  "main",
                                                                        "index":  0
                                                                    }
                                                                ]
                                                            ]
                                               },
                        "Read PDF email attachments":  {
                                                           "main":  [
                                                                        [
                                                                            {
                                                                                "node":  "PDF to JSON Agent",
                                                                                "type":  "main",
                                                                                "index":  0
                                                                            }
                                                                        ]
                                                                    ]
                                                       },
                        "Google Gemini Chat Model":  {
                                                         "ai_languageModel":  [
                                                                                  [
                                                                                      {
                                                                                          "node":  "PDF to JSON Agent",
                                                                                          "type":  "ai_languageModel",
                                                                                          "index":  0
                                                                                      }
                                                                                  ]
                                                                              ]
                                                     },
                        "Gmail Trigger":  {
                                              "main":  [
                                                           [
                                                               {
                                                                   "node":  "Get a message",
                                                                   "type":  "main",
                                                                   "index":  0
                                                               }
                                                           ]
                                                       ]
                                          },
                        "Sacar el JSON de la respuesta":  {
                                                              "main":  [
                                                                           [
                                                                               {
                                                                                   "node":  "Has any errors?",
                                                                                   "type":  "main",
                                                                                   "index":  0
                                                                               }
                                                                           ]
                                                                       ]
                                                          },
                        "Has any errors?":  {
                                                "main":  [
                                                             [
                                                                 {
                                                                     "node":  "Merge",
                                                                     "type":  "main",
                                                                     "index":  1
                                                                 },
                                                                 {
                                                                     "node":  "HTTP Request",
                                                                     "type":  "main",
                                                                     "index":  0
                                                                 }
                                                             ],
                                                             [
                                                                 {
                                                                     "node":  "Merge Errors",
                                                                     "type":  "main",
                                                                     "index":  1
                                                                 }
                                                             ]
                                                         ]
                                            },
                        "Extract from File":  {
                                                  "main":  [
                                                               [
                                                                   {
                                                                       "node":  "Agrupar facturas",
                                                                       "type":  "main",
                                                                       "index":  0
                                                                   }
                                                               ]
                                                           ]
                                              },
                        "Google Gemini Chat Model1":  {
                                                          "ai_languageModel":  [
                                                                                   [
                                                                                       {
                                                                                           "node":  "JSON to SQL Agent",
                                                                                           "type":  "ai_languageModel",
                                                                                           "index":  0
                                                                                       }
                                                                                   ]
                                                                               ]
                                                      },
                        "Is attachment a CSV?":  {
                                                     "main":  [
                                                                  [
                                                                      {
                                                                          "node":  "Extract from File",
                                                                          "type":  "main",
                                                                          "index":  0
                                                                      }
                                                                  ],
                                                                  [
                                                                      {
                                                                          "node":  "Neither PDF or CSV",
                                                                          "type":  "main",
                                                                          "index":  0
                                                                      }
                                                                  ]
                                                              ]
                                                 },
                        "Eliminar observaciones IA":  {
                                                          "main":  [
                                                                       [
                                                                           {
                                                                               "node":  "Merge PDF and CSV",
                                                                               "type":  "main",
                                                                               "index":  0
                                                                           }
                                                                       ]
                                                                   ]
                                                      },
                        "PDF to JSON Agent":  {
                                                  "main":  [
                                                               [
                                                                   {
                                                                       "node":  "Sacar el JSON de la respuesta",
                                                                       "type":  "main",
                                                                       "index":  0
                                                                   }
                                                               ]
                                                           ]
                                              },
                        "Execute a SQL query in Postgres":  {
                                                                "ai_tool":  [
                                                                                [
                                                                                    {
                                                                                        "node":  "JSON to SQL Agent",
                                                                                        "type":  "ai_tool",
                                                                                        "index":  0
                                                                                    }
                                                                                ]
                                                                            ]
                                                            },
                        "Agrupar facturas":  {
                                                 "main":  [
                                                              [
                                                                  {
                                                                      "node":  "Merge PDF and CSV",
                                                                      "type":  "main",
                                                                      "index":  1
                                                                  }
                                                              ]
                                                          ]
                                             },
                        "Merge PDF and CSV":  {
                                                  "main":  [
                                                               [
                                                                   {
                                                                       "node":  "JSON to SQL Agent",
                                                                       "type":  "main",
                                                                       "index":  0
                                                                   }
                                                               ]
                                                           ]
                                              },
                        "Merge Errors":  {
                                             "main":  [
                                                          [
                                                              {
                                                                  "node":  "Eliminar observaciones IA",
                                                                  "type":  "main",
                                                                  "index":  0
                                                              }
                                                          ]
                                                      ]
                                         },
                        "Merge":  {
                                      "main":  [
                                                   [
                                                       {
                                                           "node":  "Approved?",
                                                           "type":  "main",
                                                           "index":  0
                                                       }
                                                   ]
                                               ]
                                  },
                        "Approved?":  {
                                          "main":  [
                                                       [
                                                           {
                                                               "node":  "Merge Errors",
                                                               "type":  "main",
                                                               "index":  0
                                                           }
                                                       ]
                                                   ]
                                      },
                        "HTTP Request":  {
                                             "main":  [
                                                          [
                                                              {
                                                                  "node":  "Merge",
                                                                  "type":  "main",
                                                                  "index":  0
                                                              }
                                                          ]
                                                      ]
                                         }
                    },
    "settings":  {
                     "executionOrder":  "v1"
                 },
    "staticData":  null,
    "meta":  {
                 "templateCredsSetupCompleted":  true
             },
    "pinData":  {
                    "PDF to JSON Agent":  [
                                              {
                                                  "json":  {
                                                               "output":  "```json\n{\n  \"numero_factura\": \"\",\n  \"fecha\": \"2023-08-15\",\n  \"empresa\": {\n    \"nombre\": \"Borcelle\",\n    \"direccion\": \"Calle Cualquiera 123, Cualquier Lugar\",\n    \"mail\": \"Hola@unsitiogenial.es\",\n    \"telefono\": \"911-234-5678\",\n    \"cif\": \"\",\n    \"fax\": \"\",\n    \"web\": \"\"\n  },\n  \"cliente\": {\n    \"nombre\": \"Sandra Haro\",\n    \"direccion\": \"Calle Cualquiera 123, Cualquier Lugar\",\n    \"mail\": \"Hola@unsitiogenial.es\",\n    \"telefono\": \"911-234-5678\"\n  },\n  \"conceptos\": [\n    {\n      \"descripcion\": \"DiseÃ±o web\",\n      \"cantidad\": \"1\",\n      \"precio\": \"100\",\n      \"total_linea\": \"100\"\n    },\n    {\n      \"descripcion\": \"Publicidad\",\n      \"cantidad\": \"1\",\n      \"precio\": \"100\",\n      \"total_linea\": \"100\"\n    },\n    {\n      \"descripcion\": \"Marketing\",\n      \"cantidad\": \"1\",\n      \"precio\": \"100\",\n      \"total_linea\": \"100\"\n    },\n    {\n      \"descripcion\": \"Asistencia web\",\n      \"cantidad\": \"1\",\n      \"precio\": \"100\",\n      \"total_linea\": \"100\"\n    }\n  ],\n  \"totales\": {\n    \"subtotal\": \"500\",\n    \"impuestos\": [\n      {\n        \"porcentaje\": \"21\",\n        \"cantidad\": \"105\"\n      },\n      {\n        \"porcentaje\": \"7\",\n        \"cantidad\": \"35\"\n      }\n    ],\n    \"total\": \"500\"\n  },\n  \"forma_pago\": \"Transferencia\",\n  \"notas_factura\": \"El servicio tiene una validez de 30 dÃ­as.\",\n  \"observaciones_IA\": [\n    \"La suma de los totales de lÃ­nea de los conceptos (400) no coincide con el subtotal indicado (500).\",\n    \"El cÃ¡lculo del total (Subtotal 500 + IVA 105 - IRPF 35 = 570) no coincide con el total indicado (500).\",\n    \"Los datos de contacto (direcciÃ³n, mail, telÃ©fono) de la empresa \u0027Borcelle\u0027 son idÃ©nticos a los datos de contacto del cliente \u0027Sandra Haro\u0027, lo cual es inusual.\",\n    \"El nombre \u0027Rosa MarÃ­a Aguado\u0027 aparece al final del texto sin un contexto claro o relaciÃ³n con los campos de la factura.\"\n  ]\n}\n```"
                                                           }
                                              },
                                              {
                                                  "json":  {
                                                               "output":  "```json\n{\n  \"numero_factura\": \"98765\",\n  \"fecha\": \"2012-11-24T00:00:00\",\n  \"empresa\": {\n    \"nombre\": \"DISTRIBUCIONES FICTICIAS DE PRUEBA\",\n    \"direccion\": \"Calle y nÃºmero de mi empresa\\nMI LOCALIDAD\\n99999 MI PROVINCIA\",\n    \"mail\": \"mi_email@mailserver.com\",\n    \"telefono\": \"999-99.99.99\",\n    \"cif\": \"X0000000T\",\n    \"fax\": \"999-88.88.88\",\n    \"web\": \"www.mipaginaweb.com\"\n  },\n  \"cliente\": {\n    \"nombre\": \"PRUEBASED GARCIA PROBERO\",\n    \"direccion\": \"CL GRAN VIA 5 -DirecciÃ³n Fiscal\\nPALMA DE MALLORCA\\n07610 BALEARES\",\n    \"mail\": \"\",\n    \"telefono\": \"\"\n  },\n  \"conceptos\": [\n    {\n      \"descripcion\": \"ARTICULO ESPECÃFICO CON EL NOMBRE QUE SEA\",\n      \"cantidad\": \"1.5\",\n      \"precio\": \"600.00\",\n      \"total_linea\": \"900.00\"\n    },\n    {\n      \"descripcion\": \"OTRO ARTICULO, AQUÃ PONDRÃ SU DESCRIPCION\",\n      \"cantidad\": \"12.0\",\n      \"precio\": \"10.50\",\n      \"total_linea\": \"126.00\"\n    }\n  ],\n  \"totales\": {\n    \"subtotal\": \"1026.00\",\n    \"impuestos\": [\n      {\n        \"porcentaje\": \"21\",\n        \"cantidad\": \"215.46\"\n      }\n    ],\n    \"total\": \"1241.46\"\n  },\n  \"forma_pago\": \"CONTADO\",\n  \"notas_factura\": \"Ponga aquÃ­ su inscripciÃ³n en el Registro, u otros datos de interÃ©s para el cliente, horarios, incluso datos publicitarios como ofertas, etc.\",\n  \"observaciones_IA\": [\n    \"La factura contiene una tabla de desglose de IVA y RE (Recargo de Equivalencia), pero solo el IVA estÃ¡ claramente integrado y sumado en los totales principales de la factura. Los valores de RE no se han incluido en la secciÃ³n de impuestos dado que no forman parte de la suma final de impuestos ni se presentan con una \u0027cantidad\u0027 total explÃ­cita en el desglose final.\"\n  ]\n}\n```"
                                                           }
                                              },
                                              {
                                                  "json":  {
                                                               "output":  "```json\n{\n  \"numero_factura\": \"\",\n  \"fecha\": \"2030-08-15\",\n  \"empresa\": {\n    \"nombre\": \"BORCELLE\",\n    \"direccion\": \"Calle Cualquiera 123, Cualquier Lugar\",\n    \"mail\": \"Hola@unsitiogenial.es\",\n    \"telefono\": \"911-234-5678\",\n    \"cif\": \"\",\n    \"fax\": \"\",\n    \"web\": \"\"\n  },\n  \"cliente\": {\n    \"nombre\": \"BelÃ©n Castillo\",\n    \"direccion\": \"Calle Cualquiera 123, Cualquier Lugar\",\n    \"mail\": \"Hola@unsitiogenial.es\",\n    \"telefono\": \"911-234-5678\"\n  },\n  \"conceptos\": [\n    {\n      \"descripcion\": \"DiseÃ±o web\",\n      \"cantidad\": \"1\",\n      \"precio\": \"100\",\n      \"total_linea\": \"100\"\n    },\n    {\n      \"descripcion\": \"Publicidad\",\n      \"cantidad\": \"1\",\n      \"precio\": \"100\",\n      \"total_linea\": \"100\"\n    },\n    {\n      \"descripcion\": \"Marketing\",\n      \"cantidad\": \"1\",\n      \"precio\": \"100\",\n      \"total_linea\": \"100\"\n    },\n    {\n      \"descripcion\": \"Asistencia web\",\n      \"cantidad\": \"1\",\n      \"precio\": \"100\",\n      \"total_linea\": \"100\"\n    }\n  ],\n  \"totales\": {\n    \"subtotal\": \"500\",\n    \"impuestos\": [\n      {\n        \"porcentaje\": \"21\",\n        \"cantidad\": \"105\"\n      },\n      {\n        \"porcentaje\": \"7\",\n        \"cantidad\": \"35\"\n      }\n    ],\n    \"total\": \"500\"\n  },\n  \"forma_pago\": \"Transferencia\",\n  \"notas_factura\": \"El servicio tiene una validez de 30 dÃ­as.\",\n  \"observaciones_IA\": [\n    \"El subtotal de 500â‚¬ declarado no coincide con la suma de los totales de lÃ­nea de los conceptos (400â‚¬).\",\n    \"El total de la factura (500â‚¬) no concuerda con el cÃ¡lculo del subtotal mÃ¡s/menos impuestos (500â‚¬ subtotal + 105â‚¬ IVA - 35â‚¬ IRPF = 570â‚¬).\",\n    \"El nombre \u0027Cristina Gallego\u0027 aparece en el texto sin una asignaciÃ³n clara (cliente, empresa, contacto).\"\n  ]\n}\n```"
                                                           }
                                              }
                                          ],
                    "Sacar el JSON de la respuesta":  [
                                                          {
                                                              "json":  {
                                                                           "numero_factura":  "1",
                                                                           "fecha":  "2023-08-15",
                                                                           "empresa":  {
                                                                                           "nombre":  "Borcelle",
                                                                                           "direccion":  "Calle Cualquiera 123, Cualquier Lugar",
                                                                                           "mail":  "Hola@unsitiogenial.es",
                                                                                           "telefono":  "911-234-5678",
                                                                                           "cif":  "",
                                                                                           "fax":  "",
                                                                                           "web":  ""
                                                                                       },
                                                                           "cliente":  {
                                                                                           "nombre":  "Sandra Haro",
                                                                                           "direccion":  "Calle Cualquiera 123, Cualquier Lugar",
                                                                                           "mail":  "Hola@unsitiogenial.es",
                                                                                           "telefono":  "911-234-5678"
                                                                                       },
                                                                           "conceptos":  [
                                                                                             {
                                                                                                 "descripcion":  "DiseÃ±o web",
                                                                                                 "cantidad":  "1",
                                                                                                 "precio":  "100",
                                                                                                 "total_linea":  "100"
                                                                                             },
                                                                                             {
                                                                                                 "descripcion":  "Publicidad",
                                                                                                 "cantidad":  "1",
                                                                                                 "precio":  "100",
                                                                                                 "total_linea":  "100"
                                                                                             },
                                                                                             {
                                                                                                 "descripcion":  "Marketing",
                                                                                                 "cantidad":  "1",
                                                                                                 "precio":  "100",
                                                                                                 "total_linea":  "100"
                                                                                             },
                                                                                             {
                                                                                                 "descripcion":  "Asistencia web",
                                                                                                 "cantidad":  "1",
                                                                                                 "precio":  "100",
                                                                                                 "total_linea":  "100"
                                                                                             }
                                                                                         ],
                                                                           "totales":  {
                                                                                           "subtotal":  "500",
                                                                                           "impuestos":  [
                                                                                                             {
                                                                                                                 "porcentaje":  "21",
                                                                                                                 "cantidad":  "105"
                                                                                                             },
                                                                                                             {
                                                                                                                 "porcentaje":  "7",
                                                                                                                 "cantidad":  "35"
                                                                                                             }
                                                                                                         ],
                                                                                           "total":  "500"
                                                                                       },
                                                                           "forma_pago":  "Transferencia",
                                                                           "notas_factura":  "El servicio tiene una validez de 30 dÃ­as.",
                                                                           "observaciones_IA":  [
                                                                                                    "La suma de los totales de lÃ­nea de los conceptos (400) no coincide con el subtotal indicado (500).",
                                                                                                    "El cÃ¡lculo del total (Subtotal 500 + IVA 105 - IRPF 35 = 570) no coincide con el total indicado (500).",
                                                                                                    "Los datos de contacto (direcciÃ³n, mail, telÃ©fono) de la empresa \u0027Borcelle\u0027 son idÃ©nticos a los datos de contacto del cliente \u0027Sandra Haro\u0027, lo cual es inusual.",
                                                                                                    "El nombre \u0027Rosa MarÃ­a Aguado\u0027 aparece al final del texto sin un contexto claro o relaciÃ³n con los campos de la factura."
                                                                                                ]
                                                                       }
                                                          },
                                                          {
                                                              "json":  {
                                                                           "numero_factura":  "98765",
                                                                           "fecha":  "2012-11-24T00:00:00",
                                                                           "empresa":  {
                                                                                           "nombre":  "DISTRIBUCIONES FICTICIAS DE PRUEBA",
                                                                                           "direccion":  "Calle y nÃºmero de mi empresa\nMI LOCALIDAD\n99999 MI PROVINCIA",
                                                                                           "mail":  "mi_email@mailserver.com",
                                                                                           "telefono":  "999-99.99.99",
                                                                                           "cif":  "X0000000T",
                                                                                           "fax":  "999-88.88.88",
                                                                                           "web":  "www.mipaginaweb.com"
                                                                                       },
                                                                           "cliente":  {
                                                                                           "nombre":  "PRUEBASED GARCIA PROBERO",
                                                                                           "direccion":  "CL GRAN VIA 5 -DirecciÃ³n Fiscal\nPALMA DE MALLORCA\n07610 BALEARES",
                                                                                           "mail":  "",
                                                                                           "telefono":  ""
                                                                                       },
                                                                           "conceptos":  [
                                                                                             {
                                                                                                 "descripcion":  "ARTICULO ESPECÃFICO CON EL NOMBRE QUE SEA",
                                                                                                 "cantidad":  "1.5",
                                                                                                 "precio":  "600.00",
                                                                                                 "total_linea":  "900.00"
                                                                                             },
                                                                                             {
                                                                                                 "descripcion":  "OTRO ARTICULO, AQUÃ PONDRÃ SU DESCRIPCION",
                                                                                                 "cantidad":  "12.0",
                                                                                                 "precio":  "10.50",
                                                                                                 "total_linea":  "126.00"
                                                                                             }
                                                                                         ],
                                                                           "totales":  {
                                                                                           "subtotal":  "1026.00",
                                                                                           "impuestos":  [
                                                                                                             {
                                                                                                                 "porcentaje":  "21",
                                                                                                                 "cantidad":  "215.46"
                                                                                                             }
                                                                                                         ],
                                                                                           "total":  "1241.46"
                                                                                       },
                                                                           "forma_pago":  "CONTADO",
                                                                           "notas_factura":  "Ponga aquÃ­ su inscripciÃ³n en el Registro, u otros datos de interÃ©s para el cliente, horarios, incluso datos publicitarios como ofertas, etc.",
                                                                           "observaciones_IA":  [

                                                                                                ]
                                                                       }
                                                          },
                                                          {
                                                              "json":  {
                                                                           "numero_factura":  "2",
                                                                           "fecha":  "2030-08-15",
                                                                           "empresa":  {
                                                                                           "nombre":  "BORCELLE",
                                                                                           "direccion":  "Calle Cualquiera 123, Cualquier Lugar",
                                                                                           "mail":  "Hola@unsitiogenial.es",
                                                                                           "telefono":  "911-234-5678",
                                                                                           "cif":  "",
                                                                                           "fax":  "",
                                                                                           "web":  ""
                                                                                       },
                                                                           "cliente":  {
                                                                                           "nombre":  "BelÃ©n Castillo",
                                                                                           "direccion":  "Calle Cualquiera 123, Cualquier Lugar",
                                                                                           "mail":  "Hola@unsitiogenial.es",
                                                                                           "telefono":  "911-234-5678"
                                                                                       },
                                                                           "conceptos":  [
                                                                                             {
                                                                                                 "descripcion":  "DiseÃ±o web",
                                                                                                 "cantidad":  "1",
                                                                                                 "precio":  "100",
                                                                                                 "total_linea":  "100"
                                                                                             },
                                                                                             {
                                                                                                 "descripcion":  "Publicidad",
                                                                                                 "cantidad":  "1",
                                                                                                 "precio":  "100",
                                                                                                 "total_linea":  "100"
                                                                                             },
                                                                                             {
                                                                                                 "descripcion":  "Marketing",
                                                                                                 "cantidad":  "1",
                                                                                                 "precio":  "100",
                                                                                                 "total_linea":  "100"
                                                                                             },
                                                                                             {
                                                                                                 "descripcion":  "Asistencia web",
                                                                                                 "cantidad":  "1",
                                                                                                 "precio":  "100",
                                                                                                 "total_linea":  "100"
                                                                                             }
                                                                                         ],
                                                                           "totales":  {
                                                                                           "subtotal":  "500",
                                                                                           "impuestos":  [
                                                                                                             {
                                                                                                                 "porcentaje":  "21",
                                                                                                                 "cantidad":  "105"
                                                                                                             },
                                                                                                             {
                                                                                                                 "porcentaje":  "7",
                                                                                                                 "cantidad":  "35"
                                                                                                             }
                                                                                                         ],
                                                                                           "total":  "500"
                                                                                       },
                                                                           "forma_pago":  "Transferencia",
                                                                           "notas_factura":  "El servicio tiene una validez de 30 dÃ­as.",
                                                                           "observaciones_IA":  [
                                                                                                    "El subtotal de 500â‚¬ declarado no coincide con la suma de los totales de lÃ­nea de los conceptos (400â‚¬).",
                                                                                                    "El total de la factura (500â‚¬) no concuerda con el cÃ¡lculo del subtotal mÃ¡s/menos impuestos (500â‚¬ subtotal + 105â‚¬ IVA - 35â‚¬ IRPF = 570â‚¬).",
                                                                                                    "El nombre \u0027Cristina Gallego\u0027 aparece en el texto sin una asignaciÃ³n clara (cliente, empresa, contacto)."
                                                                                                ]
                                                                       }
                                                          }
                                                      ],
                    "HTTP Request":  [
                                         {
                                             "json":  {
                                                          "data":  {
                                                                       "approved":  true
                                                                   }
                                                      }
                                         },
                                         {
                                             "json":  {
                                                          "data":  {
                                                                       "approved":  true
                                                                   }
                                                      }
                                         }
                                     ]
                },
    "versionId":  "1e74fcc8-0817-42fa-b8f2-bc9b87f864a0",
    "triggerCount":  0,
    "tags":  [

             ]
}
